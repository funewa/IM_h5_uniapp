import{_ as e,l as s,s as t,y as a,p as l,a6 as r,q as i,L as u,o,c,w as n,g as d,i as m,n as g,d as h,e as f,F as _,h as p,t as y,f as k,r as U,k as b,I as x,j as I}from"./index.5cd51b9e.js";const C=s(t),w=a("userInfo");var v=e({data:()=>({keywords:"",group_id:"",modelName:"",userList:[],allUser:[],isAdmin:!1,isManage:!1,isAuth:!1,userInfo:w,curUser:{}}),watch:{keywords(e){""==e?this.userList=this.allUser:this.search()}},onLoad(e){this.group_id=e.group_id?e.group_id:"",this.getGroupuserlist()},methods:{getGroupuserlist(){this.userList=[],this.$api.msgApi.groupUserList({group_id:this.group_id}).then((e=>{const s=e.data.filter((e=>1==e.role&&e.userInfo.id==w.user_id));s.length&&(this.isAdmin=!0);const t=e.data.filter((e=>2==e.role&&e.userInfo.id==w.user_id));t.length&&(this.manage=!0),(s.length||t.length)&&(this.isAuth=!0);const a=e.data;a.forEach((e=>{e.realname=e.userInfo.displayName,e.name_py=e.userInfo.name_py})),this.allUser=a,this.userList=e.data}))},openModel(e){e.realname=e.userInfo.displayName,e.avatar=e.userInfo.avatar,this.curUser=e,this.modelName="userOpt"},setManage(){const e=2==this.curUser.role?3:2;this.$api.msgApi.setManager({id:this.group_id,user_id:this.curUser.user_id,role:e}).then((e=>{0==e.code&&this.getGroupuserlist(),this.modelName=""}))},removeUser(){this.modelName="",l({title:"确定要删除该成员吗?",success:e=>{e.confirm&&this.$api.msgApi.removeUser({id:this.group_id,user_id:this.curUser.user_id}).then((e=>{0==e.code&&this.getGroupuserlist()}))}})},changeOwner(){this.modelName="",l({title:"确定将管理权限转移给该成员吗?",success:e=>{e.confirm&&this.$api.msgApi.changeOwner({id:this.group_id,user_id:this.curUser.user_id}).then((e=>{0==e.code&&r({url:"/pages/index/index"})}))}})},search(){const e=JSON.parse(JSON.stringify(this.allUser));this.userList=this.$util.searchObject(e,["realname","name_py"],this.keywords)},openChatDetail(e){if(w.user_id==e.user_id)return;let s=C.getContact(e.user_id),t=C.getContact(this.group_id);if(!(t.role<3||"1"==t.setting.profile||s))return u({title:"已开启用户隐私！",icon:"none"}),!1;i({url:"/pages/contacts/detail?id="+e.user_id})}}},[["render",function(e,s,t,a,l,r){const i=U("cu-custom"),u=b,C=x,w=I,v=U("Empty");return o(),c(w,null,{default:n((()=>[d(i,{bgColor:"bg-gradual-green",isBack:!0},{backText:n((()=>[])),content:n((()=>[m("群成员")])),_:1}),d(w,{class:"cu-bar bg-white search fixed",style:g([{top:e.CustomBar+"px"}])},{default:n((()=>[d(w,{class:"search-form round"},{default:n((()=>[d(u,{class:"cuIcon-search"}),d(C,{type:"text",modelValue:l.keywords,"onUpdate:modelValue":s[0]||(s[0]=e=>l.keywords=e),placeholder:"输入搜索的关键词","confirm-type":"search"},null,8,["modelValue"])])),_:1})])),_:1},8,["style"]),d(w,{style:{"margin-top":"104rpx"}},{default:n((()=>[d(w,{class:"cu-list menu-avatar"},{default:n((()=>[(o(!0),h(_,null,f(l.userList,(e=>(o(),c(w,{class:"cu-item"},{default:n((()=>[d(w,{class:"cu-avatar round lg",style:g("background-image:url("+e.userInfo.avatar+");"),onClick:s=>r.openChatDetail(e)},null,8,["style","onClick"]),d(w,{class:"content"},{default:n((()=>[d(w,{class:"text-grey"},{default:n((()=>[d(w,{class:"text-cut"},{default:n((()=>[m(y(e.userInfo.displayName),1)])),_:2},1024),e.role<3?(o(),c(w,{key:0,class:k(["cu-tag round sm",1==e.role?"bg-red":"bg-orange"])},{default:n((()=>[m(y(1==e.role?"群主":2==e.role?"管理员":""),1)])),_:2},1032,["class"])):p("",!0),e.user_id==l.userInfo.user_id?(o(),c(w,{key:1,class:"cu-tag round sm"},{default:n((()=>[m("我")])),_:1})):p("",!0)])),_:2},1024)])),_:2},1024),d(w,{class:"action",onClick:s=>r.openModel(e)},{default:n((()=>[d(w,{class:"text-grey text-sm"},{default:n((()=>[e.role>1&&l.isAuth?(o(),c(u,{key:0,class:"cuIcon-more f-24"})):p("",!0)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),256)),l.userList.length?p("",!0):(o(),c(v,{key:0,noDatatext:"未搜索到数据",textcolor:"#999"}))])),_:1})])),_:1}),d(w,{class:k(["cu-modal bottom-modal","userOpt"==l.modelName?"show":""])},{default:n((()=>[d(w,{class:"cu-dialog"},{default:n((()=>[d(w,{class:"manage-content"},{default:n((()=>[d(w,{class:"cu-list menu bg-white"},{default:n((()=>[l.curUser?(o(),c(w,{key:0,class:"cu-item"},{default:n((()=>[d(w,{class:"content im-flex im-justify-content-center im-align-items-center"},{default:n((()=>[d(w,{class:"cu-avatar round sm",style:g("background-image:url("+l.curUser.avatar+");")},null,8,["style"]),d(w,{class:"text-cut ml-5"},{default:n((()=>[m(y(l.curUser.realname),1)])),_:1}),2==l.curUser.role?(o(),c(w,{key:0,class:"cu-tag round sm bg-orange"},{default:n((()=>[m("管理员")])),_:1})):p("",!0)])),_:1})])),_:1})):p("",!0),l.isAdmin?(o(),c(w,{key:1,class:"cu-item",onClick:s[1]||(s[1]=e=>r.changeOwner())},{default:n((()=>[d(w,{class:"content padding-tb-sm"},{default:n((()=>[d(u,{class:"c-orange"},{default:n((()=>[m("转让管理权限")])),_:1})])),_:1})])),_:1})):p("",!0),l.isAdmin?(o(),c(w,{key:2,class:"cu-item",onClick:s[2]||(s[2]=e=>r.setManage())},{default:n((()=>[d(w,{class:"content padding-tb-sm"},{default:n((()=>[d(u,null,{default:n((()=>[m(y(2==l.curUser.role?"取消管理员":"设为管理员"),1)])),_:1})])),_:1})])),_:1})):p("",!0),d(w,{class:"cu-item",onClick:s[3]||(s[3]=e=>r.removeUser())},{default:n((()=>[d(w,{class:"content padding-tb-sm"},{default:n((()=>[d(u,null,{default:n((()=>[m("移出群聊")])),_:1})])),_:1})])),_:1}),d(w,{class:"parting-line-5"}),d(w,{class:"cu-item",onClick:s[4]||(s[4]=e=>l.modelName="")},{default:n((()=>[d(w,{class:"content padding-tb-sm"},{default:n((()=>[d(u,{class:"c-red"},{default:n((()=>[m("取消")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-58c118bf"]]);export{v as default};
